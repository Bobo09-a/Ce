<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">
<title>CR√âATIVE ENTREPRISE ‚Äî Convertis tes fichiers gratuitement ‚úÖ</title>
<meta name="theme-color" content="#000000">
<style>
  :root{
    /* Th√®me noir futuriste + glass */
    --bg:#000; --grad1:#0a0b14; --grad2:#06070c;
    --glass1:rgba(255,255,255,.08); --glass2:rgba(255,255,255,.04);
    --line:#1a1e36; --txt:#f1f4ff; --muted:#aab3ff;
    --ac:#72a0ff; --ok:#33e0a3; --ko:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{min-height:100%}
  body{
    margin:0;color:var(--txt);font-family:system-ui,Inter,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1200px 800px at 80% -10%, #1b1f44 0, transparent 60%),
      radial-gradient(900px 600px at 0% 110%, #31114d 0, transparent 60%),
      linear-gradient(180deg,var(--grad1),var(--grad2)), var(--bg);
  }
  /* Header compact */
  header{
    position:sticky;top:0;z-index:20;
    background:linear-gradient(180deg,rgba(10,12,28,.88),rgba(6,7,16,.72));
    -webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);
    border-bottom:1px solid var(--line);
  }
  .head{max-width:1140px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#00e5ff,#7aa2ff);box-shadow:0 6px 20px rgba(122,162,255,.35),inset 0 0 14px rgba(255,255,255,.2)}
  .title{font-weight:900;letter-spacing:.02em;font-size:15px;line-height:1}
  .subtitle{color:var(--muted);font-size:.9rem;margin-top:2px}
  .statusBtn{
    appearance:none;border:1px solid var(--line);border-radius:999px;padding:.45rem .75rem;
    background:linear-gradient(180deg,rgba(25,31,84,.9),rgba(16,18,48,.9));color:#e6f7ff;font-weight:800
  }

  .wrap{max-width:1140px;margin:10px auto 90px;padding:0 12px}
  .app{border:1px solid var(--line);border-radius:16px;background:linear-gradient(180deg,var(--glass1),var(--glass2));
       -webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);box-shadow:0 10px 50px rgba(0,0,0,.55);overflow:hidden}
  .main{display:grid;grid-template-columns:1fr;gap:12px;padding:12px}
  @media(min-width:980px){.main{grid-template-columns:320px 1fr}}

  aside,section.panel{border:1px solid var(--line);border-radius:14px;background:linear-gradient(180deg,var(--glass1),var(--glass2));-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:10px}
  h1,h2{margin:.2rem 0 .4rem} h1{font-size:18px} h2{font-size:17px}
  .muted{color:var(--muted)} .ok{color:var(--ok)} .ko{color:var(--ko)}
  .tiles{display:grid;gap:10px}
  .tile{display:flex;gap:10px;align-items:flex-start;border:1px solid var(--line);border-radius:12px;padding:12px;cursor:pointer;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));transition:transform .12s,box-shadow .12s,outline-color .12s;outline:1px solid transparent}
  .tile:hover{transform:translateY(-1px);outline-color:#2b3aa8;box-shadow:0 8px 24px rgba(0,0,0,.35)}
  .icon{width:40px;height:40px;border-radius:10px;flex:0 0 40px;display:grid;place-items:center;background:linear-gradient(135deg,#0f1327,#1b2145);border:1px solid #2a3266;font-size:20px;box-shadow:inset 0 0 12px rgba(255,255,255,.07)}
  .tile b{display:block;margin-bottom:2px} .tile small{color:var(--muted)}

  .card{border:1px solid var(--line);border-radius:12px;padding:10px;background:linear-gradient(180deg,var(--glass1),var(--glass2))}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .row>*{flex:1}
  .grid{display:grid;gap:10px}
  .btn{appearance:none;border:1px solid var(--line);background:linear-gradient(180deg,rgba(25,31,84,.9),rgba(16,18,48,.9));color:#e6f7ff;border-radius:10px;padding:.7rem .9rem;cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(135deg,#00e5ff,#7aa2ff);color:#07122a;border-color:transparent}
  .btn.ghost{background:transparent}
  input[type=file],input[type=text],input[type=number],textarea,select{width:100%;padding:.7rem .8rem;border-radius:10px;border:1px solid #2a3688;background:#0b0f26;color:#e6f7ff}
  canvas,img,video{max-width:100%}

  /* Modale plein √©cran (outils) */
  .modal{position:fixed;inset:0;z-index:40;display:none;align-items:center;justify-content:center;padding:12px}
  .modal.open{display:flex}
  .overlay{position:absolute;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px)}
  .modalCard{position:relative;max-width:min(980px,96vw);max-height:min(92vh,900px);width:100%;height:auto;border:1px solid var(--line);border-radius:16px;background:linear-gradient(180deg,rgba(22,26,62,.95),rgba(10,12,26,.95));box-shadow:0 20px 80px rgba(0,0,0,.6);display:flex;flex-direction:column}
  .modalHead{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--line)}
  .modalBody{padding:12px;overflow:auto}
  .close{appearance:none;border:1px solid var(--line);background:linear-gradient(180deg,rgba(25,31,84,.9),rgba(16,18,48,.9));color:#e6f7ff;border-radius:10px;padding:.45rem .6rem;cursor:pointer}
  .progress{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,#00e5ff,#7aa2ff)}

  /* Footer avec Facebook */
  footer{margin-top:16px;padding:12px;border:1px solid var(--line);border-radius:14px;background:linear-gradient(180deg,var(--glass1),var(--glass2));-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}
  .fb-embed{display:grid;gap:10px;place-items:center}
  .fb-btn{display:inline-flex;align-items:center;gap:8px;text-decoration:none;background:linear-gradient(135deg,#1877f2,#6aa8ff);color:#fff;padding:.7rem 1rem;border-radius:999px;font-weight:800}
  .fb-btn .fbico{width:20px;height:20px;border-radius:50%;background:#fff;display:grid;place-items:center;color:#1877f2;font-weight:900}
</style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="head">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">CR√âATIVE ENTREPRISE</div>
          <div class="subtitle">Convertis tes fichiers gratuitement ‚úÖ</div>
        </div>
      </div>
      <button id="status" class="statusBtn">Pr√™t ‚úÖ</button>
    </div>
  </header>

  <!-- Contenu -->
  <div class="wrap">
    <div class="app">
      <div class="main">
        <!-- Menu d‚Äôoutils -->
        <aside id="menu">
          <div class="tiles">
            <div class="tile" data-tool="merge"><div class="icon">üß©</div><div><b>Fusionner PDF</b><small>Assembler plusieurs PDF</small></div></div>
            <div class="tile" data-tool="split"><div class="icon">‚úÇÔ∏è</div><div><b>S√©parer PDF</b><small>Extraire des pages</small></div></div>
            <div class="tile" data-tool="reorder"><div class="icon">üîÅ</div><div><b>R√©organiser / Rotation</b><small>Drag & rotate</small></div></div>
            <div class="tile" data-tool="numbering"><div class="icon">üî¢</div><div><b>Num√©rotation</b><small>p. 1, 2, 3‚Ä¶</small></div></div>
            <div class="tile" data-tool="removePages"><div class="icon">üóëÔ∏è</div><div><b>Supprimer pages</b><small>Paires/impaires/intervalle</small></div></div>
            <div class="tile" data-tool="pdf2img"><div class="icon">üñºÔ∏è</div><div><b>PDF ‚Üí Images</b><small>PNG par page + ZIP</small></div></div>
            <div class="tile" data-tool="img2pdf"><div class="icon">üìÑ</div><div><b>Images ‚Üí PDF</b><small>Plusieurs images ‚Üí 1 PDF</small></div></div>
            <div class="tile" data-tool="pdf2text"><div class="icon">üîé</div><div><b>PDF ‚Üí Texte</b><small>Extraction</small></div></div>
            <div class="tile" data-tool="watermark"><div class="icon">üíß</div><div><b>Filigrane (texte)</b><small>Superposition</small></div></div>
            <div class="tile" data-tool="imgtools"><div class="icon">‚úèÔ∏è</div><div><b>Rogner / Redimensionner</b><small>Outils image</small></div></div>
            <div class="tile" data-tool="removebg"><div class="icon">ü™Ñ</div><div><b>Supprimer fond (image)</b><small>Segmentation IA</small></div></div>
            <div class="tile" data-tool="img2webp"><div class="icon">ü™∂</div><div><b>Image ‚Üí WebP</b><small>R√©duire la taille</small></div></div>
            <div class="tile" data-tool="imgCompress"><div class="icon">üìâ</div><div><b>Compresser image</b><small>Qualit√© ajustable</small></div></div>
            <div class="tile" data-tool="txt2pdf"><div class="icon">üìù</div><div><b>TXT ‚Üí PDF</b><small>Fichier texte</small></div></div>
            <div class="tile" data-tool="text2pdf"><div class="icon">‚å®Ô∏è</div><div><b>Texte coll√© ‚Üí PDF</b><small>Sans fichier</small></div></div>
            <div class="tile" data-tool="compressPdf"><div class="icon">ü™Ñ</div><div><b>Compresser PDF (rapide)</b><small>Raster par page</small></div></div>
          </div>
        </aside>

        <!-- Zone info -->
        <section class="panel" id="panel">
          <div class="card">
            <h2>Bienvenue üëã</h2>
            <p class="muted">Clique sur un outil √† gauche. Chaque outil s‚Äôouvre dans une <b>fen√™tre modale</b> au centre. Tout est trait√© <b>localement</b> dans ton navigateur (mobile & PC).</p>
          </div>
        </section>
      </div>
    </div>

    <!-- Footer avec lien Facebook -->
    <footer>
      <div class="fb-embed">
        <a class="fb-btn" href="https://www.facebook.com/share/16WSwBEq3M/?mibextid=wwXIfr" target="_blank" rel="noopener">
          <span class="fbico">f</span> Suivre CR√âATIVE ENTREPRISE sur Facebook
        </a>
        <iframe
          title="Facebook"
          src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Fshare%2F16WSwBEq3M%2F%3Fmibextid%3DwwXIfr&tabs=timeline&width=340&height=180&small_header=true&adapt_container_width=true&hide_cover=false&show_facepile=true"
          width="340" height="180" style="border:none;overflow:hidden;border-radius:12px"
          scrolling="no" frameborder="0" allowfullscreen="true"
          allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share">
        </iframe>
        <div class="muted" style="text-align:center">¬© CR√âATIVE ENTREPRISE</div>
      </div>
    </footer>
  </div>

  <!-- Modale -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="overlay"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHead">
        <div id="modalTitle" style="font-weight:800">Outil</div>
        <div class="row" style="flex:0 0 auto;gap:6px">
          <div class="progress" style="width:180px"><div id="progressBar" class="bar"></div></div>
          <button id="closeModal" class="close">Fermer</button>
        </div>
      </div>
      <div id="modalBody" class="modalBody"></div>
    </div>
  </div>

  <!-- Librairies CDN -->
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.worker.min.js";</script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>

  <script>
  (()=>{'use strict';
  const $=(s,r=document)=>r.querySelector(s);
  const setStatus = (t)=> $('#status').textContent=t;
  const modal = $('#modal'), modalBody=$('#modalBody'), modalTitle=$('#modalTitle'), bar=$('#progressBar');
  const openModal = (title, html)=>{ modalTitle.textContent=title; modalBody.innerHTML=html; modal.classList.add('open'); document.body.style.overflow='hidden'; setStatus('Pr√™t ‚úÖ'); setProgress(0); };
  const closeModal = ()=>{ modal.classList.remove('open'); modalBody.innerHTML=''; document.body.style.overflow=''; setStatus('Pr√™t ‚úÖ'); };
  $('#closeModal').onclick = closeModal;
  $('.overlay').onclick = closeModal;

  function setProgress(pct, eta=''){
    bar.style.width = Math.max(0, Math.min(100, pct||0)) + '%';
    $('#status').textContent = pct>0 && pct<100 ? `Traitement‚Ä¶ ${Math.round(pct)}% ${eta?('‚Ä¢ ~'+eta+'s'):''}` : 'Pr√™t ‚úÖ';
  }
  function etaFrom(start, done, total){
    if(done===0) return '';
    const elapsed = (performance.now()-start)/1000;
    const perItem = elapsed/done;
    const remain = Math.max(0, (total-done)*perItem);
    return Math.max(1, Math.round(remain));
  }
  function downloadBlob(blob, name){ saveAs(blob, name); }
  async function readAsArrayBuffer(file){ return await file.arrayBuffer(); }
  async function readAsDataURL(file){ return await new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }
  function canvasToBlob(canvas, type='image/png', quality=0.92){ return new Promise(res=>canvas.toBlob(b=>res(b),type,quality)); }

  // Menu -> ouvre outils en modale
  $('#menu').addEventListener('click', e=>{
    const tile = e.target.closest('.tile'); if(!tile) return;
    const tool = tile.dataset.tool;
    (tools[tool]||tools.home)();
  });

  const tools = {
    home(){},
    merge(){ openModal('Fusionner des PDF', `
      <div class="grid">
        <input id="files" type="file" accept="application/pdf" multiple>
        <button id="go" class="btn primary">Fusionner</button>
      </div>`); $('#go').onclick=async()=>{
        const files=[...$('#files').files]; if(!files.length) return alert('Ajoute des PDFs');
        const start=performance.now(); setProgress(5);
        const out = await PDFLib.PDFDocument.create();
        let i=0;
        for(const f of files){
          const src = await PDFLib.PDFDocument.load(await readAsArrayBuffer(f));
          const copied = await out.copyPages(src, src.getPageIndices());
          copied.forEach(p=> out.addPage(p));
          i++; setProgress(5 + (i/files.length)*90, etaFrom(start,i,files.length));
        }
        const bytes = await out.save();
        downloadBlob(new Blob([bytes],{type:'application/pdf'}), 'fusion.pdf');
        setProgress(100,0);
      };},

    split(){ openModal('S√©parer / Extraire des pages', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <label>Pages (ex: 1-3,5,7) <input id="ranges" type="text" placeholder="1-3,5,7"></label>
        <button id="go" class="btn primary">Extraire</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
        const start=performance.now(); setProgress(5);
        const ranges = parseRanges($('#ranges').value.trim());
        const src = await PDFLib.PDFDocument.load(await readAsArrayBuffer(f));
        const out = await PDFLib.PDFDocument.create();
        const pages = (ranges.length? ranges : src.getPageIndices().map(i=>i+1)).map(n=>n-1).filter(i=> i>=0 && i<src.getPageCount());
        const copied = await out.copyPages(src, pages);
        copied.forEach((p,idx)=>{ out.addPage(p); setProgress(5 + ((idx+1)/copied.length)*90, etaFrom(start, idx+1, copied.length)); });
        const bytes = await out.save();
        downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_extrait.pdf');
        setProgress(100,0);
      };},

    reorder(){ openModal('R√©organiser / Rotation', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <div id="pages" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px"></div>
        <button id="save" class="btn primary">Exporter PDF</button>
      </div>`); let srcPdf, order=[], rotations=[];
      $('#file').onchange=async()=>{
        const f=$('#file').files[0]; if(!f) return;
        const start=performance.now(); setProgress(5);
        const arr = await readAsArrayBuffer(f);
        const pdfjs = await pdfjsLib.getDocument({data:arr}).promise;
        srcPdf = await PDFLib.PDFDocument.load(arr);
        order = Array.from({length: pdfjs.numPages}, (_,i)=>i); rotations = order.map(()=>0);
        const list = $('#pages'); list.innerHTML='';
        for(let i=1;i<=pdfjs.numPages;i++){
          const page=await pdfjs.getPage(i);
          const viewport=page.getViewport({scale:.4});
          const canvas=document.createElement('canvas'); const ctx=canvas.getContext('2d');
          canvas.width=viewport.width; canvas.height=viewport.height;
          await page.render({canvasContext:ctx,viewport}).promise;
          const card=document.createElement('div'); card.className='card'; card.draggable=true; card.dataset.idx=(i-1);
          card.innerHTML=`<div class="row" style="align-items:flex-start"><img src="${canvas.toDataURL()}" style="width:100%"></div>
                          <div class="row"><button class="btn rotL">‚ü≤</button><button class="btn rotR">‚ü≥</button></div>`;
          list.appendChild(card); setProgress(5 + (i/pdfjs.numPages)*90, etaFrom(start,i,pdfjs.numPages));
        }
        // DnD
        let dragEl=null;
        list.addEventListener('dragstart', e=>{ dragEl=e.target.closest('.card'); e.dataTransfer.setData('text/plain','x');});
        list.addEventListener('dragover', e=>{ e.preventDefault(); const tgt=e.target.closest('.card'); if(!tgt||tgt===dragEl) return; const b=tgt.getBoundingClientRect(); const after=(e.clientY-b.top)>(b.height/2); list.insertBefore(dragEl, after?tgt.nextSibling:tgt); });
        list.addEventListener('drop', ()=>{ order=[...list.children].map(c=>parseInt(c.dataset.idx,10)); });
        list.addEventListener('click', e=>{
          const card=e.target.closest('.card'); if(!card) return; const idx=parseInt(card.dataset.idx,10);
          if(e.target.classList.contains('rotL')) rotations[idx]=(rotations[idx]-90)%360;
          if(e.target.classList.contains('rotR')) rotations[idx]=(rotations[idx]+90)%360;
          setStatus(`Rotation page ${idx+1}: ${rotations[idx]}¬∞`);
        });
        setProgress(100,0);
      };
      $('#save').onclick=async()=>{
        if(!srcPdf) return alert('Ajoute un PDF');
        const start=performance.now(); setProgress(5);
        const out = await PDFLib.PDFDocument.create();
        for(let i=0;i<order.length;i++){
          const srcIndex=order[i];
          const [copied]=await out.copyPages(srcPdf,[srcIndex]);
          if(rotations[srcIndex]) copied.setRotation(PDFLib.degrees((rotations[srcIndex]+360)%360));
          out.addPage(copied);
          setProgress(5 + ((i+1)/order.length)*90, etaFrom(start,i+1,order.length));
        }
        const bytes=await out.save(); downloadBlob(new Blob([bytes],{type:'application/pdf'}),'reorganise.pdf'); setProgress(100,0);
      };},

    numbering(){ openModal('Num√©rotation des pages', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <div class="row">
          <label>Taille <input id="size" type="number" value="12"></label>
          <label>Opacit√© (0.1‚Äì1) <input id="op" type="number" min="0.1" max="1" step="0.1" value="0.8"></label>
          <label>Position <select id="pos"><option value="bc">Bas centre</option><option value="bl">Bas gauche</option><option value="br">Bas droit</option></select></label>
        </div>
        <button id="go" class="btn primary">Appliquer</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
        const size=parseFloat($('#size').value||12), op=Math.max(.1,Math.min(1,parseFloat($('#op').value||.8))), pos=$('#pos').value;
        const start=performance.now(); setProgress(5);
        const pdf=await PDFLib.PDFDocument.load(await readAsArrayBuffer(f));
        const font=await pdf.embedFont(PDFLib.StandardFonts.Helvetica);
        const pages=pdf.getPages();
        for(let i=0;i<pages.length;i++){
          const p=pages[i]; const {width,height}=p.getSize(); const text=String(i+1);
          let x=width/2-6,y=14; if(pos==='bl'){x=16;y=14;} if(pos==='br'){x=width-30;y=14;}
          p.drawText(text,{x,y,size,font,color:PDFLib.rgb(1,1,1),opacity:op});
          setProgress(5 + ((i+1)/pages.length)*90, etaFrom(start,i+1,pages.length));
        }
        const bytes=await pdf.save(); downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_num.pdf'); setProgress(100,0);
      };},

    removePages(){ openModal('Supprimer des pages', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <div class="row">
          <label>Action <select id="mode">
            <option value="odd">Supprimer impaires</option>
            <option value="even">Supprimer paires</option>
            <option value="range">Supprimer intervalle</option>
          </select></label>
          <label>Intervalle (ex: 2-5) <input id="range" type="text" placeholder="2-5"></label>
        </div>
        <button id="go" class="btn primary">Supprimer</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
        const mode=$('#mode').value, range=$('#range').value.trim();
        const start=performance.now(); setProgress(5);
        const src=await PDFLib.PDFDocument.load(await readAsArrayBuffer(f));
        const out=await PDFLib.PDFDocument.create();
        const total=src.getPageCount();
        let keep=[];
        if(mode==='odd'){ for(let i=0;i<total;i++) if((i+1)%2===0) keep.push(i); }
        else if(mode==='even'){ for(let i=0;i<total;i++) if((i+1)%2===1) keep.push(i); }
        else { // range
          const [a,b]=(range||'').split('-').map(v=>parseInt(v,10));
          const del=new Set(); if(!isNaN(a)&&!isNaN(b)){ for(let i=Math.min(a,b)-1;i<=Math.max(a,b)-1;i++) del.add(i); }
          for(let i=0;i<total;i++) if(!del.has(i)) keep.push(i);
        }
        const copied=await out.copyPages(src, keep);
        for(let i=0;i<copied.length;i++){ out.addPage(copied[i]); setProgress(5 + ((i+1)/copied.length)*90, etaFrom(start,i+1,copied.length)); }
        const bytes=await out.save(); downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_clean.pdf'); setProgress(100,0);
      };},

    pdf2img(){ openModal('PDF ‚Üí Images (PNG) + ZIP', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <label>√âchelle (1‚Äì3) <input id="scale" type="number" step="0.25" value="2"></label>
        <div id="out" class="grid"></div>
        <button id="go" class="btn primary">Convertir</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
        const scale=Math.max(1,Math.min(3,parseFloat($('#scale').value||2)));
        const pdf=await pdfjsLib.getDocument({data:await readAsArrayBuffer(f)}).promise;
        const out=$('#out'); out.innerHTML=''; const zip=new JSZip(); const start=performance.now();
        for(let p=1;p<=pdf.numPages;p++){
          setProgress((p-1)/pdf.numPages*90+5, etaFrom(start,p-1,pdf.numPages));
          const page=await pdf.getPage(p); const viewport=page.getViewport({scale});
          const canvas=document.createElement('canvas'); const ctx=canvas.getContext('2d');
          canvas.width=viewport.width; canvas.height=viewport.height;
          await page.render({canvasContext:ctx,viewport}).promise;
          const blob=await canvasToBlob(canvas,'image/png',0.95); const arr=new Uint8Array(await blob.arrayBuffer());
          zip.file(f.name.replace(/\.pdf$/i,'')+`_p${String(p).padStart(3,'0')}.png`,arr);
          const url=URL.createObjectURL(blob); const card=document.createElement('div'); card.className='card';
          const img=new Image(); img.src=url; img.style.maxWidth='100%';
          const a=document.createElement('a'); a.href=url; a.download=f.name.replace(/\.pdf$/i,'')+`_p${String(p).padStart(3,'0')}.png`; a.textContent='T√©l√©charger page '+p;
          card.appendChild(img); card.appendChild(a); out.appendChild(card);
        }
        setProgress(95, etaFrom(start,pdf.numPages,pdf.numPages));
        const zipBlob=await zip.generateAsync({type:'blob'}); downloadBlob(zipBlob, f.name.replace(/\.pdf$/i,'')+'_pages.zip'); setProgress(100,0);
      };},

    img2pdf(){ openModal('Images ‚Üí PDF', `
      <div class="grid">
        <input id="files" type="file" accept="image/*" multiple>
        <label>Taille page <select id="format">
          <option value="a4">A4 (portrait)</option><option value="a4l">A4 (paysage)</option><option value="letter">US Letter</option>
        </select></label>
        <button id="go" class="btn primary">G√©n√©rer</button>
      </div>`); $('#go').onclick=async()=>{
        const files=[...$('#files').files]; if(!files.length) return alert('Ajoute des images');
        const { jsPDF } = window.jspdf; const sel=$('#format').value; const conf=sel==='a4'?['a4','portrait']:sel==='a4l'?['a4','landscape']:['letter','portrait'];
        const pdf=new jsPDF({unit:'pt',format:conf[0],orientation:conf[1]}); let first=true; const start=performance.now();
        for(let i=0;i<files.length;i++){
          const f=files[i]; const url=await readAsDataURL(f); const img=new Image(); img.src=url; await img.decode();
          if(!first) pdf.addPage(); first=false;
          const W=pdf.internal.pageSize.getWidth(), H=pdf.internal.pageSize.getHeight();
          const r=Math.min(W/img.width,H/img.height,1), w=img.width*r, h=img.height*r, x=(W-w)/2, y=(H-h)/2;
          pdf.addImage(url,'PNG',x,y,w,h);
          setProgress(((i+1)/files.length)*95, etaFrom(start,i+1,files.length));
        }
        const blob=pdf.output('blob'); downloadBlob(blob,'images_to_pdf.pdf'); setProgress(100,0);
      };},

    pdf2text(){ openModal('PDF ‚Üí Texte', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <button id="go" class="btn primary">Extraire</button>
        <textarea id="out" rows="10" placeholder="Texte extrait appara√Ætra ici‚Ä¶"></textarea>
        <button id="save" class="btn">T√©l√©charger .txt</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
        const pdf=await pdfjsLib.getDocument({data:await readAsArrayBuffer(f)}).promise; let all=''; const start=performance.now();
        for(let p=1;p<=pdf.numPages;p++){
          const page=await pdf.getPage(p); const content=await page.getTextContent(); const text=content.items.map(i=>i.str).join(' '); all+=text+'\n';
          setProgress((p/pdf.numPages)*95, etaFrom(start,p,pdf.numPages));
        }
        $('#out').value=all.trim(); setProgress(100,0);
      }; $('#save').onclick=()=>{ const blob=new Blob([$('#out').value||''],{type:'text/plain;charset=utf-8'}); downloadBlob(blob,'extrait.txt'); };},

    watermark(){ openModal('Filigrane (texte)', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <label>Texte <input id="txt" type="text" placeholder="CONFIDENTIEL ‚Äî CR√âATIVE ENTREPRISE"></label>
        <div class="row"><label>Taille <input id="size" type="number" value="48"></label><label>Opacit√© <input id="op" type="number" min="0.1" max="1" step="0.1" value="0.2"></label></div>
        <button id="go" class="btn primary">Appliquer</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
        const text=$('#txt').value||'CONFIDENTIEL ‚Äî CR√âATIVE ENTREPRISE'; const size=parseFloat($('#size').value||48); const op=Math.max(.1,Math.min(1,parseFloat($('#op').value||.2)));
        const start=performance.now(); setProgress(5);
        const pdf=await PDFLib.PDFDocument.load(await readAsArrayBuffer(f)); const font=await pdf.embedFont(PDFLib.StandardFonts.HelveticaBold);
        const pages=pdf.getPages();
        for(let i=0;i<pages.length;i++){
          const p=pages[i]; const {width,height}=p.getSize();
          p.drawText(text,{x:width/6,y:height/2,size,font,color:PDFLib.rgb(1,1,1),rotate:PDFLib.degrees(315),opacity:op});
          setProgress(5 + ((i+1)/pages.length)*90, etaFrom(start,i+1,pages.length));
        }
        const bytes=await pdf.save(); downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_watermark.pdf'); setProgress(100,0);
      };},

    imgtools(){ openModal('Rogner / Redimensionner', `
      <div class="grid">
        <input id="file" type="file" accept="image/*">
        <div class="row"><label>Largeur(px) <input id="w" type="number" placeholder="auto"></label><label>Hauteur(px) <input id="h" type="number" placeholder="auto"></label></div>
        <canvas id="cvs"></canvas>
        <div class="row"><button id="fitw" class="btn">Adapter largeur</button><button id="fith" class="btn">Adapter hauteur</button><button id="save" class="btn primary">T√©l√©charger PNG</button></div>
      </div>`); const cvs=$('#cvs'), ctx=cvs.getContext('2d'); let img=null,sx=0,sy=0,sw=0,sh=0,drag=false,ax=0,ay=0;
      $('#file').onchange=async()=>{const f=$('#file').files[0]; if(!f) return; const url=await readAsDataURL(f); img=new Image(); img.src=url; await img.decode(); cvs.width=img.width; cvs.height=img.height; sx=0; sy=0; sw=img.width; sh=img.height; draw();};
      function draw(){ if(!img) return; ctx.clearRect(0,0,cvs.width,cvs.height); ctx.drawImage(img,0,0); ctx.strokeStyle='#7aa2ff'; ctx.lineWidth=2; ctx.strokeRect(sx,sy,sw,sh); }
      cvs.onmousedown=e=>{ if(!img) return; drag=true; ax=e.offsetX; ay=e.offsetY; sx=ax; sy=ay; sw=10; sh=10; draw(); };
      cvs.onmousemove=e=>{ if(!drag) return; sw=Math.max(10,e.offsetX-ax); sh=Math.max(10,e.offsetY-ay); draw(); };
      cvs.onmouseup=()=> drag=false;
      $('#fitw').onclick=()=>{ const W=parseInt($('#w').value||0,10); if(!img||!W) return; const r=W/img.width; cvs.width=W; cvs.height=Math.round(img.height*r); draw(); };
      $('#fith').onclick=()=>{ const H=parseInt($('#h').value||0,10); if(!img||!H) return; const r=H/img.height; cvs.height=H; cvs.width=Math.round(img.width*r); draw(); };
      $('#save').onclick=async()=>{ if(!img) return; const tmp=document.createElement('canvas'); tmp.width=sw; tmp.height=sh; tmp.getContext('2d').drawImage(img,sx,sy,sw,sh,0,0,sw,sh); const blob=await canvasToBlob(tmp,'image/png',0.95); downloadBlob(blob,'image_edit.png'); };},

    removebg(){ openModal('Suppression de fond ‚Äî image (IA)', `
      <div class="grid">
        <input id="file" type="file" accept="image/*">
        <button id="go" class="btn primary">Supprimer le fond</button>
        <canvas id="cvs"></canvas>
        <button id="save" class="btn">T√©l√©charger PNG</button>
        <p class="muted">Optimis√© pour photos de personnes (MediaPipe Selfie Segmentation).</p>
      </div>`); const cvs=$('#cvs'), ctx=cvs.getContext('2d'); let img=null;
      $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis une image');
        const url=await readAsDataURL(f); img=new Image(); img.src=url; await img.decode(); cvs.width=img.width; cvs.height=img.height;
        setProgress(10);
        const seg=new SelfieSegmentation.SelfieSegmentation({locateFile:(file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`}); seg.setOptions({modelSelection:1});
        seg.onResults(res=>{
          const mask=res.segmentationMask; const mcv=document.createElement('canvas'); mcv.width=cvs.width; mcv.height=cvs.height; const mctx=mcv.getContext('2d');
          mctx.drawImage(mask,0,0,cvs.width,cvs.height);
          const mdata=mctx.getImageData(0,0,cvs.width,cvs.height);
          const srccv=document.createElement('canvas'); srccv.width=img.width; srccv.height=img.height; srccv.getContext('2d').drawImage(img,0,0);
          const sdata=srccv.getContext('2d').getImageData(0,0,img.width,img.height);
          const out=ctx.createImageData(cvs.width,cvs.height);
          for(let i=0;i<out.data.length;i+=4){ const a=mdata.data[i]; out.data[i]=sdata.data[i]; out.data[i+1]=sdata.data[i+1]; out.data[i+2]=sdata.data[i+2]; out.data[i+3]=a; }
          ctx.putImageData(out,0,0); setProgress(100,0);
        });
        const tmp=document.createElement('canvas'); tmp.width=img.width; tmp.height=img.height; tmp.getContext('2d').drawImage(img,0,0);
        await seg.send({image:tmp});
      };
      $('#save').onclick=async()=>{ const blob=await canvasToBlob(cvs,'image/png',0.95); downloadBlob(blob,'image_sans_fond.png'); };},

    img2webp(){ openModal('Image ‚Üí WebP', `
      <div class="grid">
        <input id="file" type="file" accept="image/*">
        <label>Qualit√© (0.3‚Äì0.95) <input id="q" type="number" step="0.05" min="0.2" max="1" value="0.8"></label>
        <button id="go" class="btn primary">Convertir</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis une image'); const q=Math.max(.2,Math.min(.95,parseFloat($('#q').value||.8)));
        const url=await readAsDataURL(f); const img=new Image(); img.src=url; await img.decode();
        const canvas=document.createElement('canvas'); canvas.width=img.width; canvas.height=img.height; canvas.getContext('2d').drawImage(img,0,0);
        setProgress(50);
        const blob=await canvasToBlob(canvas,'image/webp',q); downloadBlob(blob, f.name.replace(/\.[^.]+$/,'')+'.webp'); setProgress(100,0);
      };},

    imgCompress(){ openModal('Compresser image (JPEG/WebP)', `
      <div class="grid">
        <input id="file" type="file" accept="image/*">
        <label>Format <select id="fmt"><option value="image/jpeg">JPEG</option><option value="image/webp">WebP</option><option value="image/png">PNG</option></select></label>
        <label>Qualit√© (0.3‚Äì0.95) <input id="q" type="number" step="0.05" min="0.2" max="1" value="0.8"></label>
        <button id="go" class="btn primary">Compresser</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis une image'); const q=Math.max(.2,Math.min(.95,parseFloat($('#q').value||.8))); const fmt=$('#fmt').value;
        const url=await readAsDataURL(f); const img=new Image(); img.src=url; await img.decode();
        const canvas=document.createElement('canvas'); canvas.width=img.width; canvas.height=img.height; canvas.getContext('2d').drawImage(img,0,0);
        setProgress(50);
        const blob=await canvasToBlob(canvas,fmt,q); const ext = fmt==='image/jpeg'?'.jpg':fmt==='image/webp'?'.webp':'.png';
        downloadBlob(blob, f.name.replace(/\.[^.]+$/,'')+ext); setProgress(100,0);
      };},

    txt2pdf(){ openModal('TXT ‚Üí PDF', `
      <div class="grid">
        <input id="file" type="file" accept=".txt,.md,.markdown">
        <button id="go" class="btn primary">Convertir</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un .txt/.md');
        const { jsPDF } = window.jspdf; const pdf=new jsPDF({unit:'pt',format:'a4'}); const text=await (await f.text()); const lines=pdf.splitTextToSize(text,520); let y=60; const start=performance.now();
        for(let i=0;i<lines.length;i++){ const ln=lines[i]; if(y>760){ pdf.addPage(); y=60; } pdf.text(40,y,ln); y+=16; if(i%50===0) setProgress((i/lines.length)*95, etaFrom(start,i,lines.length)); }
        const blob=pdf.output('blob'); downloadBlob(blob, f.name.replace(/\.(txt|md|markdown)$/i,'')+'.pdf'); setProgress(100,0);
      };},

    text2pdf(){ openModal('Texte coll√© ‚Üí PDF', `
      <div class="grid">
        <textarea id="txt" rows="10" placeholder="Colle ici ton texte‚Ä¶"></textarea>
        <button id="go" class="btn primary">Cr√©er le PDF</button>
      </div>`); $('#go').onclick=()=>{
        const val=$('#txt').value||''; if(!val.trim()) return alert('Colle du texte'); const { jsPDF }=window.jspdf; const pdf=new jsPDF({unit:'pt',format:'a4'}); const lines=pdf.splitTextToSize(val,520); let y=60;
        for(const ln of lines){ if(y>760){ pdf.addPage(); y=60; } pdf.text(40,y,ln); y+=16; } const blob=pdf.output('blob'); downloadBlob(blob,'texte.pdf'); setProgress(100,0);
      };},

    compressPdf(){ openModal('Compresser PDF (rapide ‚Äî raster)', `
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <label>Qualit√© images (0.3‚Äì0.95) <input id="q" type="number" step="0.05" min="0.2" max="1" value="0.7"></label>
        <label>Largeur max (px) <input id="mw" type="number" value="1600"></label>
        <button id="go" class="btn primary">Compresser</button>
      </div>`); $('#go').onclick=async()=>{
        const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
        const q=Math.max(.2,Math.min(.95,parseFloat($('#q').value||.7))); const maxW=parseInt($('#mw').value||1600,10);
        const src=new Uint8Array(await readAsArrayBuffer(f)); const pdf=await pdfjsLib.getDocument({data:src}).promise; const out=await PDFLib.PDFDocument.create(); const start=performance.now();
        for(let p=1;p<=pdf.numPages;p++){
          const page=await pdf.getPage(p); const viewport=page.getViewport({scale:2});
          const canvas=document.createElement('canvas'); const ctx=canvas.getContext('2d');
          canvas.width=Math.min(viewport.width,maxW); canvas.height=Math.round(canvas.width*(viewport.height/viewport.width));
          await page.render({canvasContext:ctx,viewport:page.getViewport({scale:canvas.width/viewport.width})}).promise;
          const blob=await canvasToBlob(canvas,'image/jpeg',q); const arr=new Uint8Array(await blob.arrayBuffer());
          const img=await out.embedJpg(arr); const pg=out.addPage([img.width,img.height]); pg.drawImage(img,{x:0,y:0,width:img.width,height:img.height});
          setProgress((p/pdf.numPages)*95, etaFrom(start,p,pdf.numPages));
        }
        const bytes=await out.save(); downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_compressed.pdf'); setProgress(100,0);
      };}
  };

  function parseRanges(ranges){
    if(!ranges) return [];
    const parts=ranges.split(',').map(s=>s.trim()).filter(Boolean); const out=new Set();
    for(const part of parts){
      if(part.includes('-')){ const [a,b]=part.split('-').map(v=>parseInt(v,10)); for(let i=Math.min(a,b); i<=Math.max(a,b); i++) out.add(i); }
      else{ const v=parseInt(part,10); if(!isNaN(v)) out.add(v); }
    }
    return [...out].sort((x,y)=>x-y);
  }
  })();
  </script>
</body>
</html>
