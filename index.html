<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>CR√âATIVE ENTREPRISE ‚Äî Convertis tes fichiers gratuitement ‚úÖ</title>
<meta name="theme-color" content="#000000">
<style>
  :root{
    /* Palette futuriste */
    --bg:#000; --grad1:#0a0a0f; --grad2:#050507;
    --glass:rgba(255,255,255,.06); --glass2:rgba(255,255,255,.04);
    --line:#1b1e33; --txt:#f2f5ff; --muted:#aab1ff;
    --ac1:#7aa2ff; --ok:#3be6b0; --ko:#ff6b6b;
    --tile:#0d0f1f; --tile2:#0b0d1a;
  }
  *{box-sizing:border-box}
  html,body{min-height:100%}
  body{
    margin:0; color:var(--txt); font-family:system-ui, Inter, Segoe UI, Roboto, Arial, sans-serif;
    background:
      radial-gradient(1200px 800px at 80% -10%, #1b1f44 0, transparent 60%),
      radial-gradient(900px 600px at 0% 110%, #31114d 0, transparent 60%),
      linear-gradient(180deg, var(--grad1), var(--grad2)), var(--bg);
  }
  .wrap{max-width:1140px; margin:0 auto; padding:16px 14px 100px; /* laisse scroller jusqu‚Äôen bas */}
  header{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg, rgba(10,12,28,.85), rgba(5,6,18,.65));
    -webkit-backdrop-filter: blur(12px); backdrop-filter: blur(12px);
    border-bottom:1px solid var(--line);
  }
  .head{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:14px 10px;
  }
  .brand{
    display:flex; align-items:center; gap:10px;
    font-weight:900; letter-spacing:.02em; font-size:18px;
  }
  .logo{
    width:34px; height:34px; border-radius:10px;
    background:linear-gradient(135deg, #00e5ff, #7aa2ff);
    box-shadow:0 6px 22px rgba(122,162,255,.35), inset 0 0 18px rgba(255,255,255,.22);
  }
  .subtitle{color:var(--muted); font-size:.95rem}
  .app{
    margin-top:14px;
    border:1px solid var(--line); border-radius:16px;
    background:linear-gradient(180deg, rgba(18,20,40,.7), rgba(8,10,22,.7));
    -webkit-backdrop-filter: blur(14px); backdrop-filter: blur(14px);
    box-shadow:0 10px 50px rgba(0,0,0,.55);
    overflow:hidden;
  }

  /* Layout mobile-first (colonne) */
  .main{
    display:grid; grid-template-columns:1fr; gap:12px; padding:12px;
  }
  @media (min-width:980px){
    .main{ grid-template-columns:320px 1fr; }
  }

  aside, section.panel{
    border:1px solid var(--line); border-radius:14px;
    background:linear-gradient(180deg, var(--glass), var(--glass2));
    -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
    padding:10px;
  }
  h1,h2{margin:.2rem 0 .4rem}
  h1{font-size:20px} h2{font-size:18px}
  .muted{color:var(--muted)} .ok{color:var(--ok)} .ko{color:var(--ko)}

  /* Tuiles d‚Äôoutils */
  .tiles{display:grid; gap:10px}
  .tile{
    display:flex; gap:10px; align-items:flex-start;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid var(--line); border-radius:12px; padding:12px; cursor:pointer;
    transition:transform .12s ease, box-shadow .12s ease, outline-color .12s ease;
    outline:1px solid transparent;
  }
  .tile:hover{ transform:translateY(-1px); outline-color:#2b3aa8; box-shadow:0 8px 24px rgba(0,0,0,.35); }
  .icon{
    width:40px; height:40px; border-radius:10px; flex:0 0 40px;
    display:grid; place-items:center;
    background:linear-gradient(135deg,#111426,#1a1f3f); border:1px solid #2a3266;
    box-shadow:inset 0 0 12px rgba(255,255,255,.06);
    font-size:20px;
  }
  .tile b{display:block; margin-bottom:2px}
  .tile small{color:var(--muted)}

  .grid{display:grid; gap:10px}
  .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .row>*{flex:1}
  .card{border:1px solid var(--line); border-radius:12px; padding:10px; background:linear-gradient(180deg, var(--glass), var(--glass2))}
  .btn{
    appearance:none; border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(25,31,84,.9), rgba(16,18,48,.9));
    color:#e6f7ff; border-radius:10px; padding:.7rem .9rem; cursor:pointer; font-weight:700
  }
  .btn.primary{background:linear-gradient(135deg,#00e5ff,#7aa2ff); color:#07122a; border-color:transparent}
  .btn.ghost{background:transparent}
  input[type=file],input[type=text],input[type=number],textarea,select{
    width:100%; padding:.7rem .8rem; border-radius:10px; border:1px solid #2a3688; background:#0b0f26; color:#e6f7ff
  }
  canvas,img,video{max-width:100%}
  .chip{padding:.2rem .45rem; border:1px solid var(--line); border-radius:999px; background:rgba(255,255,255,.05); font-variant-numeric:tabular-nums}

  /* Footer (en bas, lisible, pas fix√©) */
  footer{
    margin-top:16px; padding:12px; border:1px solid var(--line); border-radius:14px;
    background:linear-gradient(180deg, var(--glass), var(--glass2));
    -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
  }
  .fb-embed{display:grid; gap:10px; place-items:center}
  .fb-btn{
    display:inline-flex; align-items:center; gap:8px; text-decoration:none;
    background:linear-gradient(135deg,#1877f2,#6aa8ff); color:#fff; padding:.7rem 1rem; border-radius:999px; font-weight:800
  }
  .fb-btn .fbico{width:20px; height:20px; border-radius:50%; background:#fff; display:grid; place-items:center; color:#1877f2; font-weight:900}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="head">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div style="font-size:16px;">CR√âATIVE ENTREPRISE</div>
            <div class="subtitle">Convertis tes fichiers gratuitement ‚úÖ</div>
          </div>
        </div>
        <div class="chip" id="status">Pr√™t ‚úÖ</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="app">
      <div class="main">
        <!-- Menu -->
        <aside id="menu">
          <div class="tiles">
            <div class="tile" data-tool="merge"><div class="icon">üß©</div><div><b>Fusionner PDF</b><small>Assembler plusieurs PDF</small></div></div>
            <div class="tile" data-tool="split"><div class="icon">‚úÇÔ∏è</div><div><b>S√©parer PDF</b><small>Extraire des pages</small></div></div>
            <div class="tile" data-tool="reorder"><div class="icon">üîÅ</div><div><b>R√©organiser / Rotation</b><small>Drag & rotate</small></div></div>
            <div class="tile" data-tool="compress"><div class="icon">ü™∂</div><div><b>Compresser PDF</b><small>R√©duire la taille</small></div></div>
            <div class="tile" data-tool="watermark"><div class="icon">üíß</div><div><b>Filigrane PDF</b><small>Texte en superposition</small></div></div>
            <div class="tile" data-tool="pdf2img"><div class="icon">üñºÔ∏è</div><div><b>PDF ‚Üí Images</b><small>PNG par page</small></div></div>
            <div class="tile" data-tool="img2pdf"><div class="icon">üìÑ</div><div><b>Images ‚Üí PDF</b><small>Plusieurs images ‚Üí 1 PDF</small></div></div>
            <div class="tile" data-tool="pdf2text"><div class="icon">üîé</div><div><b>PDF ‚Üí Texte</b><small>Extraction de texte</small></div></div>
            <div class="tile" data-tool="pdfimages"><div class="icon">üß≤</div><div><b>Extraire images d‚Äôun PDF</b><small>R√©cup√©rer les visuels</small></div></div>
            <div class="tile" data-tool="imgtools"><div class="icon">‚úèÔ∏è</div><div><b>Rogner / Redimensionner</b><small>Outils image</small></div></div>
            <div class="tile" data-tool="removebg"><div class="icon">ü™Ñ</div><div><b>Supprimer fond (image)</b><small>Segmentation IA</small></div></div>
            <div class="tile" data-tool="txt2pdf"><div class="icon">üìù</div><div><b>TXT ‚Üí PDF</b><small>Bloc de texte ‚Üí PDF</small></div></div>
          </div>
        </aside>

        <!-- Panneau -->
        <section class="panel" id="panel">
          <div class="card">
            <h2>Bienvenue üëã</h2>
            <p class="muted">Choisis un outil √† gauche. Tout est trait√© <b>localement</b> dans ton navigateur (mobile & PC). D√©ploie ce fichier unique sur GitHub¬†Pages.</p>
          </div>
        </section>
      </div>
    </div>

    <!-- Footer avec lien Facebook embarqu√© -->
    <footer>
      <div class="fb-embed">
        <a class="fb-btn" href="https://www.facebook.com/share/16WSwBEq3M/?mibextid=wwXIfr" target="_blank" rel="noopener">
          <span class="fbico">f</span> Suivre CR√âATIVE ENTREPRISE sur Facebook
        </a>
        <!-- Int√©gration embarqu√©e (si la cible est une Page Facebook valide) -->
        <iframe
          title="Facebook"
          src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Fshare%2F16WSwBEq3M%2F%3Fmibextid%3DwwXIfr&tabs=timeline&width=340&height=180&small_header=true&adapt_container_width=true&hide_cover=false&show_facepile=true"
          width="340" height="180" style="border:none;overflow:hidden;border-radius:12px"
          scrolling="no" frameborder="0" allowfullscreen="true"
          allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share">
        </iframe>
        <div class="muted" style="text-align:center">¬© CR√âATIVE ENTREPRISE</div>
      </div>
    </footer>
  </div>

  <!-- Librairies CDN -->
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.worker.min.js";</script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>

  <script>
  (()=>{'use strict';
  const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>[...r.querySelectorAll(s)];
  const setStatus = t=> $('#status').textContent = t;
  $('#menu').addEventListener('click', e=>{
    const tile = e.target.closest('.tile'); if(!tile) return;
    const tool = tile.dataset.tool;
    (builders[tool]||builders.home)();
    window.scrollTo({top: document.querySelector('.app').offsetTop - 8, behavior:'smooth'});
    setStatus('Pr√™t ‚úÖ');
  });

  const builders = {
    home(){ $('#panel').innerHTML='<div class="card"><h2>Bienvenue</h2><p class="muted">Choisis un outil √† gauche.</p></div>'; },
    merge: uiMerge,
    split: uiSplit,
    reorder: uiReorder,
    compress: uiCompress,
    watermark: uiWatermark,
    pdf2img: uiPDF2IMG,
    img2pdf: uiIMG2PDF,
    pdf2text: uiPDF2TEXT,
    pdfimages: uiPDFImages,
    imgtools: uiIMGTools,
    removebg: uiRemoveBG,
    txt2pdf: uiTXT2PDF
  };

  /* Helpers */
  function downloadBlob(blob, name){ saveAs(blob, name); }
  async function readAsArrayBuffer(file){ return await file.arrayBuffer(); }
  async function readAsDataURL(file){ return await new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }
  function canvasToBlob(canvas, type='image/png', quality=0.92){ return new Promise(res=>canvas.toBlob(b=>res(b),type,quality)); }

  /* ====== Merge PDFs ====== */
  function uiMerge(){
    $('#panel').innerHTML = `
      <div class="card"><h2>Fusionner des PDF</h2>
        <div class="grid">
          <input id="files" type="file" accept="application/pdf" multiple>
          <button id="go" class="btn primary">Fusionner</button>
        </div>
      </div>`;
    $('#go').onclick = async ()=>{
      const files=[...$('#files').files]; if(!files.length) return alert('Ajoute des PDFs');
      setStatus('Fusion‚Ä¶');
      const out = await PDFLib.PDFDocument.create();
      for(const f of files){
        const src = await PDFLib.PDFDocument.load(await readAsArrayBuffer(f));
        const copied = await out.copyPages(src, src.getPageIndices());
        copied.forEach(p=> out.addPage(p));
      }
      const bytes = await out.save();
      downloadBlob(new Blob([bytes],{type:'application/pdf'}), 'fusion.pdf');
      setStatus('Termin√© ‚úÖ');
    };
  }

  /* ====== Split PDF ====== */
  function uiSplit(){
    $('#panel').innerHTML = `
      <div class="card"><h2>S√©parer / Extraire des pages</h2>
        <div class="grid">
          <input id="file" type="file" accept="application/pdf">
          <label>Pages (ex: 1-3,5,7) <input id="ranges" type="text" placeholder="1-3,5,7"></label>
          <button id="go" class="btn primary">Extraire</button>
        </div>
      </div>`;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
      const ranges = parseRanges($('#ranges').value.trim());
      setStatus('Extraction‚Ä¶');
      const src = await PDFLib.PDFDocument.load(await readAsArrayBuffer(f));
      const out = await PDFLib.PDFDocument.create();
      const pages = (ranges.length? ranges : src.getPageIndices().map(i=>i+1)).map(n=>n-1).filter(i=> i>=0 && i<src.getPageCount());
      const copied = await out.copyPages(src, pages);
      copied.forEach(p=> out.addPage(p));
      const bytes = await out.save();
      downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_extrait.pdf');
      setStatus('Termin√© ‚úÖ');
    };
  }
  function parseRanges(ranges){
    if(!ranges) return [];
    const parts = ranges.split(',').map(s=>s.trim()).filter(Boolean);
    const out = new Set();
    for(const part of parts){
      if(part.includes('-')){
        const [a,b]=part.split('-').map(v=>parseInt(v,10));
        for(let i=Math.min(a,b); i<=Math.max(a,b); i++) out.add(i);
      }else{ const v=parseInt(part,10); if(!isNaN(v)) out.add(v); }
    }
    return [...out].sort((x,y)=>x-y);
  }

  /* ====== Reorder/Rotate ====== */
  function uiReorder(){
    $('#panel').innerHTML = `
      <div class="card"><h2>R√©organiser / Rotation de pages</h2>
        <div class="grid">
          <input id="file" type="file" accept="application/pdf">
          <div id="pages" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px"></div>
          <button id="save" class="btn primary">Exporter PDF</button>
        </div>
      </div>`;
    let srcPdf, order=[], rotations=[];
    $('#file').onchange = async ()=>{
      const f=$('#file').files[0]; if(!f) return;
      setStatus('Rendu des miniatures‚Ä¶');
      const arr = await readAsArrayBuffer(f);
      const pdfjs = await pdfjsLib.getDocument({data:arr}).promise;
      srcPdf = await PDFLib.PDFDocument.load(arr);
      order = Array.from({length: pdfjs.numPages}, (_,i)=>i);
      rotations = order.map(()=>0);
      const list = $('#pages'); list.innerHTML='';
      for(let i=1;i<=pdfjs.numPages;i++){
        const page = await pdfjs.getPage(i);
        const viewport = page.getViewport({scale:.4});
        const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
        canvas.width = viewport.width; canvas.height = viewport.height;
        await page.render({canvasContext:ctx,viewport}).promise;
        const card = document.createElement('div'); card.className='card'; card.draggable=true; card.dataset.idx=(i-1);
        card.innerHTML = `<div class="row" style="align-items:flex-start"><img src="${canvas.toDataURL()}" style="width:100%"></div>
          <div class="row"><button class="btn rotL">‚ü≤</button><button class="btn rotR">‚ü≥</button></div>`;
        list.appendChild(card);
      }
      // drag & drop
      let dragEl=null;
      list.addEventListener('dragstart', e=>{ dragEl=e.target.closest('.card'); e.dataTransfer.setData('text/plain','x');});
      list.addEventListener('dragover', e=>{ e.preventDefault(); const tgt=e.target.closest('.card'); if(!tgt||tgt===dragEl) return; const b=tgt.getBoundingClientRect(); const after=(e.clientY-b.top)>(b.height/2); list.insertBefore(dragEl, after?tgt.nextSibling:tgt); });
      list.addEventListener('drop', ()=>{ order=[...list.children].map(c=>parseInt(c.dataset.idx,10)); });

      list.addEventListener('click', e=>{
        const card = e.target.closest('.card'); if(!card) return;
        const idx = parseInt(card.dataset.idx,10);
        if(e.target.classList.contains('rotL')) rotations[idx]=(rotations[idx]-90)%360;
        if(e.target.classList.contains('rotR')) rotations[idx]=(rotations[idx]+90)%360;
        setStatus(`Rotation page ${idx+1}: ${rotations[idx]}¬∞`);
      });
      setStatus('Pr√™t ‚úÖ (drag pour r√©ordonner; ‚ü≤/‚ü≥ pour pivoter)');
    };

    $('#save').onclick = async ()=>{
      if(!srcPdf) return alert('Ajoute un PDF');
      setStatus('G√©n√©ration du PDF‚Ä¶');
      const out = await PDFLib.PDFDocument.create();
      for(const srcIndex of order){
        const [copied] = await out.copyPages(srcPdf, [srcIndex]);
        if(rotations[srcIndex]) copied.setRotation(PDFLib.degrees((rotations[srcIndex]+360)%360));
        out.addPage(copied);
      }
      const bytes = await out.save();
      downloadBlob(new Blob([bytes],{type:'application/pdf'}), 'reorganise.pdf');
      setStatus('Termin√© ‚úÖ');
    };
  }

  /* ====== Compress PDF ====== */
  function uiCompress(){
    $('#panel').innerHTML = `
      <div class="card"><h2>Compresser PDF</h2>
        <div class="grid">
          <input id="file" type="file" accept="application/pdf">
          <label>Qualit√© images (0.3‚Äì0.95) <input id="q" type="number" step="0.05" min="0.2" max="1" value="0.7"></label>
          <label>Largeur max (px) <input id="mw" type="number" value="1600"></label>
          <button id="go" class="btn primary">Compresser</button>
          <p class="muted" style="margin:.2rem 0 0">Option rapide¬†: rasteriser les pages pour une compression forte (texte non s√©lectionnable).</p>
        </div>
      </div>`;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
      const quality = Math.max(0.2, Math.min(0.95, parseFloat($('#q').value||0.7)));
      const maxW = parseInt($('#mw').value||1600,10);
      setStatus('Compression‚Ä¶');
      const srcBytes = new Uint8Array(await readAsArrayBuffer(f));
      const pdf = await pdfjsLib.getDocument({data:srcBytes}).promise;
      const out2 = await PDFLib.PDFDocument.create();
      for(let i=1;i<=pdf.numPages;i++){
        const page = await pdf.getPage(i);
        const viewport = page.getViewport({scale:2});
        const canvas=document.createElement('canvas'); const ctx=canvas.getContext('2d');
        canvas.width = Math.min(viewport.width, maxW);
        canvas.height = Math.round(canvas.width * (viewport.height/viewport.width));
        await page.render({canvasContext:ctx, viewport: page.getViewport({scale: canvas.width/viewport.width})}).promise;
        const blob = await canvasToBlob(canvas, 'image/jpeg', quality);
        const arr = new Uint8Array(await blob.arrayBuffer());
        const img = await out2.embedJpg(arr);
        const pg = out2.addPage([img.width, img.height]);
        pg.drawImage(img, {x:0,y:0,width:img.width,height:img.height});
      }
      const bytes = await out2.save();
      downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_compressed.pdf');
      setStatus('Termin√© ‚úÖ');
    };
  }

  /* ====== Watermark ====== */
  function uiWatermark(){
    $('#panel').innerHTML = `
    <div class="card"><h2>Filigrane (texte)</h2>
      <div class="grid">
        <input id="file" type="file" accept="application/pdf">
        <label>Texte <input id="txt" type="text" placeholder="CONFIDENTIEL ‚Äî CR√âATIVE ENTREPRISE"></label>
        <label>Taille <input id="size" type="number" value="48"></label>
        <label>Opacit√© (0.1‚Äì1) <input id="op" type="number" min="0.1" max="1" step="0.1" value="0.2"></label>
        <button id="go" class="btn primary">Appliquer</button>
      </div>
    </div>`;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
      const text = $('#txt').value || 'CONFIDENTIEL ‚Äî CR√âATIVE ENTREPRISE';
      const size = parseFloat($('#size').value||48);
      const op = Math.max(.1, Math.min(1, parseFloat($('#op').value||.2)));
      setStatus('Filigrane‚Ä¶');
      const src = await PDFLib.PDFDocument.load(await readAsArrayBuffer(f));
      const font = await src.embedFont(PDFLib.StandardFonts.HelveticaBold);
      src.getPages().forEach(p=>{
        const { width, height } = p.getSize();
        p.drawText(text, { x: width/6, y: height/2, size, font, color: PDFLib.rgb(1,1,1), rotate: PDFLib.degrees(315), opacity: op });
      });
      const bytes = await src.save();
      downloadBlob(new Blob([bytes],{type:'application/pdf'}), f.name.replace(/\.pdf$/i,'')+'_watermark.pdf');
      setStatus('Termin√© ‚úÖ');
    };
  }

  /* ====== PDF ‚Üí Images ====== */
  function uiPDF2IMG(){
    $('#panel').innerHTML = `
      <div class="card"><h2>PDF ‚Üí PNG (par page)</h2>
        <div class="grid">
          <input id="file" type="file" accept="application/pdf">
          <label>√âchelle (1‚Äì3) <input id="scale" type="number" step="0.25" value="2"></label>
          <div id="out" class="grid"></div>
          <button id="go" class="btn primary">Convertir</button>
        </div>
      </div>`;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
      const scale = Math.max(1, Math.min(3, parseFloat($('#scale').value||2)));
      setStatus('Rendu‚Ä¶');
      const pdf = await pdfjsLib.getDocument({data:await readAsArrayBuffer(f)}).promise;
      const out=$('#out'); out.innerHTML='';
      for(let p=1;p<=pdf.numPages;p++){
        const page = await pdf.getPage(p);
        const viewport = page.getViewport({scale});
        const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
        canvas.width=viewport.width; canvas.height=viewport.height;
        await page.render({canvasContext:ctx,viewport}).promise;
        const blob = await canvasToBlob(canvas,'image/png',0.95);
        const url = URL.createObjectURL(blob);
        const card = document.createElement('div'); card.className='card';
        const img = new Image(); img.src=url; img.style.maxWidth='100%';
        const a = document.createElement('a'); a.href=url; a.download=f.name.replace(/\.pdf$/i,'')+`_p${String(p).padStart(3,'0')}.png`; a.textContent='T√©l√©charger page '+p;
        card.appendChild(img); card.appendChild(a); out.appendChild(card);
      }
      setStatus('Termin√© ‚úÖ');
    };
  }

  /* ====== Images ‚Üí PDF ====== */
  function uiIMG2PDF(){
    $('#panel').innerHTML = `
      <div class="card"><h2>Images ‚Üí PDF</h2>
        <div class="grid">
          <input id="files" type="file" accept="image/*" multiple>
          <label>Taille page <select id="format">
            <option value="a4">A4 (portrait)</option><option value="a4l">A4 (paysage)</option>
            <option value="letter">US Letter</option>
          </select></label>
          <button id="go" class="btn primary">G√©n√©rer</button>
        </div>
      </div>`;
    $('#go').onclick = async ()=>{
      const files=[...$('#files').files]; if(!files.length) return alert('Ajoute des images');
      setStatus('Cr√©ation‚Ä¶');
      const { jsPDF } = window.jspdf;
      const fmtSel = $('#format').value;
      const conf = fmtSel==='a4' ? ['a4','portrait'] : fmtSel==='a4l' ? ['a4','landscape'] : ['letter','portrait'];
      const pdf = new jsPDF({unit:'pt', format:conf[0], orientation:conf[1]});
      let first=true;
      for(const f of files){
        const url=await readAsDataURL(f); const img=new Image(); img.src=url; await img.decode();
        if(!first) pdf.addPage(); first=false;
        const pageW=pdf.internal.pageSize.getWidth(), pageH=pdf.internal.pageSize.getHeight();
        const r=Math.min(pageW/img.width, pageH/img.height, 1);
        const w=img.width*r, h=img.height*r; const x=(pageW-w)/2, y=(pageH-h)/2;
        pdf.addImage(url, 'PNG', x, y, w, h);
      }
      const blob = pdf.output('blob');
      downloadBlob(blob, 'images_to_pdf.pdf');
      setStatus('Termin√© ‚úÖ');
    };
  }

  /* ====== PDF ‚Üí Texte ====== */
  function uiPDF2TEXT(){
    $('#panel').innerHTML = `
      <div class="card"><h2>PDF ‚Üí Texte</h2>
        <div class="grid">
          <input id="file" type="file" accept="application/pdf">
          <button id="go" class="btn primary">Extraire</button>
          <textarea id="out" rows="10" placeholder="Texte extrait appara√Ætra ici‚Ä¶"></textarea>
          <button id="save" class="btn">T√©l√©charger .txt</button>
        </div>
      </div>`;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
      setStatus('Extraction du texte‚Ä¶');
      const pdf = await pdfjsLib.getDocument({data:await readAsArrayBuffer(f)}).promise;
      let all='';
      for(let p=1;p<=pdf.numPages;p++){
        const page = await pdf.getPage(p);
        const content = await page.getTextContent();
        const text = content.items.map(i=>i.str).join(' ');
        all += text + '\n';
      }
      $('#out').value = all.trim();
      setStatus('Termin√© ‚úÖ');
    };
    $('#save').onclick = ()=>{
      const blob = new Blob([$('#out').value||''], {type:'text/plain;charset=utf-8'});
      downloadBlob(blob, 'extrait.txt');
    };
  }

  /* ====== Extraire images du PDF ====== */
  function uiPDFImages(){
    $('#panel').innerHTML = `
      <div class="card"><h2>Extraire les images d‚Äôun PDF</h2>
        <div class="grid">
          <input id="file" type="file" accept="application/pdf">
          <div id="out" class="grid"></div>
          <button id="go" class="btn primary">Extraire</button>
        </div>
        <p class="muted" style="margin:.2rem 0 0">Technique¬†: rendu page‚ÜíPNG (efficace pour r√©cup√©rer tout visuel).</p>
      </div>`;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis un PDF');
      setStatus('Rendu‚Ä¶');
      const pdf = await pdfjsLib.getDocument({data:await readAsArrayBuffer(f)}).promise;
      const out=$('#out'); out.innerHTML='';
      for(let p=1;p<=pdf.numPages;p++){
        const page = await pdf.getPage(p);
        const viewport = page.getViewport({scale:2});
        const canvas=document.createElement('canvas'); const ctx=canvas.getContext('2d');
        canvas.width=viewport.width; canvas.height=viewport.height;
        await page.render({canvasContext:ctx,viewport}).promise;
        const blob = await canvasToBlob(canvas,'image/png',0.95);
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a'); a.href=url; a.download=f.name.replace(/\.pdf$/i,'')+`_page${String(p).padStart(3,'0')}.png`; a.textContent='T√©l√©charger page '+p;
        const card=document.createElement('div'); card.className='card'; const img=new Image(); img.src=url; img.style.maxWidth='100%';
        card.appendChild(img); card.appendChild(a); out.appendChild(card);
      }
      setStatus('Termin√© ‚úÖ');
    };
  }

  /* ====== Outils image ====== */
  function uiIMGTools(){
    $('#panel').innerHTML = `
      <div class="card"><h2>Rogner / Redimensionner</h2>
        <div class="grid">
          <input id="file" type="file" accept="image/*">
          <div class="row">
            <label>Largeur(px) <input id="w" type="number" placeholder="auto"></label>
            <label>Hauteur(px) <input id="h" type="number" placeholder="auto"></label>
          </div>
          <canvas id="cvs"></canvas>
          <div class="row">
            <button id="fitw" class="btn">Adapter largeur</button>
            <button id="fith" class="btn">Adapter hauteur</button>
            <button id="save" class="btn primary">T√©l√©charger PNG</button>
          </div>
        </div>
      </div>`;
    const cvs=$('#cvs'), ctx=cvs.getContext('2d'); let img=null,sx=0,sy=0,sw=0,sh=0,drag=false,ax=0,ay=0;
    $('#file').onchange = async ()=>{
      const f=$('#file').files[0]; if(!f) return;
      const url=await readAsDataURL(f); img=new Image(); img.src=url; await img.decode();
      cvs.width=img.width; cvs.height=img.height; sx=0; sy=0; sw=img.width; sh=img.height; draw();
    };
    function draw(){ if(!img) return; ctx.clearRect(0,0,cvs.width,cvs.height); ctx.drawImage(img,0,0); ctx.strokeStyle='#7aa2ff'; ctx.lineWidth=2; ctx.strokeRect(sx,sy,sw,sh); }
    cvs.onmousedown=e=>{ if(!img) return; drag=true; ax=e.offsetX; ay=e.offsetY; sx=ax; sy=ay; sw=10; sh=10; draw(); };
    cvs.onmousemove=e=>{ if(!drag) return; sw=Math.max(10,e.offsetX-ax); sh=Math.max(10,e.offsetY-ay); draw(); };
    cvs.onmouseup=()=> drag=false;
    $('#fitw').onclick=()=>{ const W=parseInt($('#w').value||0,10); if(!img||!W) return; const r=W/img.width; cvs.width=W; cvs.height=Math.round(img.height*r); draw(); };
    $('#fith').onclick=()=>{ const H=parseInt($('#h').value||0,10); if(!img||!H) return; const r=H/img.height; cvs.height=H; cvs.width=Math.round(img.width*r); draw(); };
    $('#save').onclick=async()=>{ if(!img) return; const tmp=document.createElement('canvas'); tmp.width=sw; tmp.height=sh; tmp.getContext('2d').drawImage(img,sx,sy,sw,sh,0,0,sw,sh); const blob=await canvasToBlob(tmp,'image/png',0.95); downloadBlob(blob,'image_edit.png'); };
  }

  /* ====== Supprimer fond (image) ====== */
  function uiRemoveBG(){
    $('#panel').innerHTML = `
      <div class="card"><h2>Suppression de fond ‚Äî image</h2>
        <div class="grid">
          <input id="file" type="file" accept="image/*">
          <button id="go" class="btn primary">Supprimer le fond</button>
          <canvas id="cvs"></canvas>
          <button id="save" class="btn">T√©l√©charger PNG</button>
          <p class="muted" style="margin:.2rem 0 0">Optimis√© pour photos de personnes (MediaPipe).</p>
        </div>
      </div>`;
    const cvs=$('#cvs'), ctx=cvs.getContext('2d'); let img=null;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis une image');
      setStatus('Segmentation IA‚Ä¶');
      const url=await readAsDataURL(f); img=new Image(); img.src=url; await img.decode();
      cvs.width=img.width; cvs.height=img.height;
      const seg = new SelfieSegmentation.SelfieSegmentation({locateFile:(file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`});
      seg.setOptions({modelSelection:1});
      seg.onResults(res=>{
        const mask = res.segmentationMask;
        const mcv=document.createElement('canvas'); mcv.width=cvs.width; mcv.height=cvs.height; const mctx=mcv.getContext('2d');
        mctx.drawImage(mask,0,0,cvs.width,cvs.height);
        const mdata=mctx.getImageData(0,0,cvs.width,cvs.height);
        const srccv=document.createElement('canvas'); srccv.width=img.width; srccv.height=img.height; srccv.getContext('2d').drawImage(img,0,0);
        const sdata=srccv.getContext('2d').getImageData(0,0,img.width,img.height);
        const out=ctx.createImageData(cvs.width,cvs.height);
        for(let i=0;i<out.data.length;i+=4){
          const a=mdata.data[i]; out.data[i]=sdata.data[i]; out.data[i+1]=sdata.data[i+1]; out.data[i+2]=sdata.data[i+2]; out.data[i+3]=a;
        }
        ctx.putImageData(out,0,0);
        setStatus('Termin√© ‚úÖ');
      });
      const tmp=document.createElement('canvas'); tmp.width=img.width; tmp.height=img.height; tmp.getContext('2d').drawImage(img,0,0);
      await seg.send({image: tmp});
    };
    $('#save').onclick = async ()=>{ const blob=await canvasToBlob(cvs,'image/png',0.95); downloadBlob(blob,'image_sans_fond.png'); };
  }

  /* ====== TXT ‚Üí PDF ====== */
  function uiTXT2PDF(){
    $('#panel').innerHTML = `
      <div class="card"><h2>TXT ‚Üí PDF</h2>
        <div class="grid">
          <input id="file" type="file" accept=".txt,.md,.markdown">
          <button id="go" class="btn primary">Convertir</button>
        </div>
      </div>`;
    $('#go').onclick = async ()=>{
      const f=$('#file').files[0]; if(!f) return alert('Choisis un .txt ou .md');
      setStatus('Conversion‚Ä¶');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({unit:'pt', format:'a4'});
      const text = await (await f.text());
      const lines = pdf.splitTextToSize(text, 520);
      let y=60; for(const ln of lines){ if(y>760){ pdf.addPage(); y=60; } pdf.text(40,y,ln); y+=16; }
      const blob = pdf.output('blob'); downloadBlob(blob, f.name.replace(/\.(txt|md|markdown)$/i,'')+'.pdf');
      setStatus('Termin√© ‚úÖ');
    };
  }
  })();
  </script>
</body>
</html>
